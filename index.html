<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Terminal Portfolio</title>

    <link rel="icon" type="image/x-icon" href="images/favicon.png">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;1,100;1,200;1,300;1,400;1,500;1,600;1,700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />

    <link rel="stylesheet" href="css/style.css" />
    
    <!--Firebase-->
    <script type="module" src="./js/config.js"></script>
    
</head>
<body>

    <div id="loading-screen">
        <pre id="loading-text">Loading TerminalPortfolio...</pre>
    </div>

    <div id="cmdAlert" class="cmd-alert">
        <span class="cmd-icon">C:\></span>
        <div class="cmd-content">
            
        </div>

        <button id="closeAlert" class="button-54" role="button">Ok</button>
    </div>

    <div class="container">
        <div class="terminal">
            <div class="header">
                <span class="material-symbols-outlined headerSymbol">terminal</span>
                <span class="headerName">C:\Windows\System32\portfolio.exe</span>
                <span class="material-symbols-outlined closeTerminal">close</span>
            </div>
            <div class="terminalBody">
                <span style="color: white; margin-top: 10px;">Gonçalo Portfolio [Version 10.0.19045.4529]</span>
                <span style="color: white;">(c) Gonçalo Silva. All rights reserved.</span>

                <img src="images/terminalPortfolioLogo.png" width="50%" style="margin-top: 30px;">

                <span style="color: white; margin-top: 30px;">Type 'help' to see list of available commands.</span>

                <div style="margin-top: 20px;" class="inputActiveDiv">
                    <span style="color: bisque;"><span style="color: aquamarine;">guest</span>@<span style="color: lightsalmon;">portfolio.com</span>:$~</span>
                    <input class="active" type="text" style="color: white;" autofocus>
                </div>

            </div>
        </div>
    </div>
</body>
</html>
<script type="module">

    import { db, ref, push, get, auth, getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged } from './js/config.js';

    var terminal = {  
        //games
        gameMode: false,
        //game pong
        ballDirectionX: 1,
        ballDirectionY: 1,
        ballSpeed: 2,
        ballTouches: 0,
        interval: null,
        //projects
        gitHubAccount: "goncalosilva07",
        projectName: null,
        //login
        isLogin: 0,
        //feedback
        isFeedback: 0,

        quote: function(){

            return new Promise(function(resolve, reject) {
                var htmlToAppend = '';

                htmlToAppend += '<div style="margin-right: 30px; display: inline-grid; margin-top: 15px; color: white">'; 

                $.ajax({
                    url: 'https://api.quotable.io/quotes/random?tags=failure|courage|faith|success|inspirational|honor|future',
                    type: 'GET',
                    contentType: "application/json",
                    data: null,
                    success: function (data) {    
                        htmlToAppend += '<span style="font-weight: 500;">[' + data[0].tags + ']</span><br>';
                        htmlToAppend += '<span style="font-weight: 500;">"' + data[0].content + '"</span> - ' + data[0].author;
                        htmlToAppend += '</div>';
                        resolve(htmlToAppend); 
                    },
                    error: function (data) {
                        htmlToAppend += 'No inspirational phrases at the moment.';
                        htmlToAppend += '</div>';
                        resolve(htmlToAppend); 
                    }
                });
            });
        },

        download: function (){

            const fileName = "cv.pdf"; // Nome do ficheiro
            const filePath = "downloads/" + fileName; // Caminho do ficheiro
            
            // Criar um link para o download
            const link = document.createElement("a");
            link.href = filePath;
            link.download = fileName;
            link.style.display = "none";

            // Adicionar ao DOM, clicar no link e remover
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);

            var htmlToAppend = '<div style="margin-right: 30px; margin-top: 15px; color: white">';
            htmlToAppend += '<span>Downloading...</span>';
            htmlToAppend += '</div>';

            terminal.sendEmail('Downloading CV', '-');

            return htmlToAppend;
        },

        sendEmail: function (title, description){

            const data = {
                name: 'Gonçalo Silva',
                email: 'goncalo7878s@gmail.com',
                message: 'Title: ' + title + '. Description: ' + description
            };

            $.ajax({
                url: 'https://formspree.io/f/xpwqavjb',
                method: 'POST',
                data: JSON.stringify(data),
                contentType: 'application/json',
                success: function (response) {
                    console.log('E-mail enviado com sucesso:', response);
                },
                error: function (error) {
                    console.error('Erro ao enviar o e-mail:', error);
                },
            });
        },

        showAlert: function(message) {
            $(".cmd-content").html(message);
            $("#cmdAlert").fadeIn(1000);
            setTimeout(function() { terminal.closeAlert(); }, 5000);
        },

        closeAlert: function(message){
            $("#cmdAlert").fadeOut(1000);
        },

        feedbackList: async function (){
            return new Promise(async function(resolve, reject) {

                var htmlToAppend = '';
                htmlToAppend += '<div style="margin-right: 30px; display: inline-grid; margin-top: 15px; color: white">'; 

                const feedbacksRef = ref(db, 'feedbacks');

                get(feedbacksRef)
                .then(async (snapshot) => {
                    if (snapshot.exists()) {
                        for(const values in snapshot.val()){
                            const value = snapshot.val()[values];
                            htmlToAppend += '<div style="margin-top:10px"> --------------------------- <br>' +
                                            '<span>' + value.date + ' ' + value.time + '</span><br>' +
                                            '<span>Title: ' + value.title + '</span><br>' +
                                            '<span>Description: ' + value.description + '</span>' +
                                            '</div> ---------------------------';
                            
                        }

                        htmlToAppend += '</div>';
                        resolve(htmlToAppend);
                    } else {
                        htmlToAppend += 'No data to show.';
                        htmlToAppend += '</div>';
                        resolve(htmlToAppend);
                    }
                })
                .catch((error) => {
                    htmlToAppend += error;
                    htmlToAppend += '</div>';
                    resolve(htmlToAppend);
                });
            });

        },

        newFeedback: function (title, description) {

            const feedbackRef = ref(db, 'feedbacks');
            const now = new Date();

            const feedback = {
                date: now.toLocaleDateString(),
                time: now.toLocaleTimeString(),
                title: title,
                description: description
            };

            push(feedbackRef, feedback)
                .then(() => {
                    terminal.showAlert('Feedback submitted successfully'); 
                    terminal.sendEmail(title, description);
                })
                .catch((error) => terminal.showAlert(error));
        },

        feedbackForm: function(){
            var htmlToAppend = '';

            htmlToAppend += '<div style="margin-right: 30px; margin-top: 15px;">' +
                            '<div style="margin-top: 15px; margin-bottom: 30px;">' +
                            '<img src="images/feedback.png" width="30%">' +
                            '</div>'; 

            htmlToAppend += '<div class="dashed-border-leftAndRight" style="width: 30%;">';
            htmlToAppend += '<div class=" dashed-border-topAndBottom" style="padding: 10px;">';    
            htmlToAppend += '<span style="color: white;">title: </span><input class="feedback_title active" type="text" style="color: white; width: 79%;"><br>';
            htmlToAppend += '<span style="color: white;">description: </span><input class="feedback_description active" type="text" style="color: white; width: 62%;"><br>';
            htmlToAppend += '</div>';
            htmlToAppend += '</div>';
            htmlToAppend += '<span style="color: white;">Press ENTER to conitnue...</span>';
            htmlToAppend += '</div>';

            return htmlToAppend;   
        },

        contacts: function(){
            var contacts = {'email':'goncalo7878s@gmail.com', 'linkedin': 'https://www.linkedin.com/in/gonçalo-silva-8b89a91a0', 
                      'gitHub': 'https://github.com/goncalosilva07'},
            htmlToAppend = "";
            $.each(contacts, function(index, value){          
                if (index == 'email'){
                    htmlToAppend += '<span style="color: white; margin-left: 20px;"> > ' + index + ' - ' + value + '</span>';
                }else{
                    htmlToAppend += '<span style="color: white; margin-left: 20px;"> > ' + index + ' - <a href="' + value + '">' + value + '</a></span>';
                }
            });
            return htmlToAppend;
        },

        loginForm: function() {
            var htmlToAppend = '';
            htmlToAppend += '<div style="margin-right: 30px; margin-top: 15px;">' +
                            '<div style="margin-top: 15px; margin-bottom: 30px;">' +
                            '<img src="images/login.png" width="25%">' +
                            '</div>'; 

            htmlToAppend += '<div class="dashed-border-leftAndRight" style="width: 30%;">';
            htmlToAppend += '<div class=" dashed-border-topAndBottom" style="padding: 10px;">';    
            htmlToAppend += '<span style="color: white;">email: </span><input class="login_email active" type="text" style="color: white;"><br>';
            htmlToAppend += '<span style="color: white;">password: </span><input class="login_pass active" type="text" style="color: white;"><br>';
            htmlToAppend += '</div>';
            htmlToAppend += '</div>';
            htmlToAppend += '<span style="color: white;">Press ENTER to conitnue...</span>';
            htmlToAppend += '</div>';

            return htmlToAppend;   
        },

        login: function (email, password){
            signInWithEmailAndPassword(auth, email, password)
                    .then((userCredential) => {
                        //login com sucesso
                        const user = userCredential.user;  
                        //alert('Login successfully');   
                        terminal.showAlert('Login successfully');  
                    })
                    .catch((error) => {
                        //alert(error);
                        terminal.showAlert(error);   
                    });      
        },

        visitsList: async function (){
            return new Promise(async function(resolve, reject) {

                var htmlToAppend = '';
                htmlToAppend += '<div style="margin-right: 30px; display: inline-grid; margin-top: 15px; color: white">'; 

                const visitsRef = ref(db, 'visits');

                // Obter os dados da referência
                get(visitsRef)
                .then(async (snapshot) => {
                    if (snapshot.exists()) {
                        for(const values in snapshot.val()){
                            const value = snapshot.val()[values];
                            await $.ajax({
                                url: 'https://get.geojs.io/v1/ip/geo/' + value.ip + '.json',
                                method: 'GET',
                                success: function(data) {
                                    htmlToAppend += '> ' + value.ip + ' (' + data.country + ', ' + data.region + ') -> ' + value.date + ' ' + value.time + '<br>';
                                },
                                error: function(error) {
                                    htmlToAppend += '> ' + value.ip + ' -> ' + value.date + ' ' + value.time + '<br>';
                                }
                            });
                        }

                        htmlToAppend += '</div>';
                        resolve(htmlToAppend);
                    } else {
                        htmlToAppend += 'No data to show.';
                        htmlToAppend += '</div>';
                        resolve(htmlToAppend);
                    }
                })
                .catch((error) => {
                    htmlToAppend += error;
                    htmlToAppend += '</div>';
                    resolve(htmlToAppend);
                });
            });

        },

        newVisit: function (userIP) {
            
            const visitRef = ref(db, 'visits');  // Criando referência para "visits"
            const now = new Date();

            const visit = {
                date: now.toLocaleDateString(),
                time: now.toLocaleTimeString(),
                ip: userIP  // Aqui você pode adicionar o IP se quiser
            };

            // Guardar dados no Firebase Realtime Database
            push(visitRef, visit)
                .then(() => {
                    terminal.sendEmail('New Visit', visit.date + ' ' + visit.time);
                })
                .catch((error) => console.error('Erro ao guardar dados:', error));
        },

        getUserIP: function () {
            $.get("https://api.ipify.org?format=json", function(data) {
                
                const userIP = data.ip;
                terminal.newVisit(userIP);
            });
        },

        enter: async function(command){

            if (terminal.isLogin == 1){    
                terminal.login($(".login_email").val(), $(".login_pass").val());
                terminal.isLogin = 0;
                terminal.enter("clear");
                return true;  
            }

            if (terminal.isFeedback == 1){    
                terminal.newFeedback($(".feedback_title").val(), $(".feedback_description").val());
                terminal.isFeedback = 0;
                terminal.enter("clear");
                return true;  
            }

            //
            $(".inputActiveDiv").remove();
            var htmlToAppend = $(".terminalBody").html();
            htmlToAppend += '<div style="margin-top: 20px;">' +
                            '<span style="color: bisque;"><span style="color: aquamarine;">guest</span>@<span style="color: lightsalmon;">portfolio.com</span>:$~</span>' + 
                            '<span style="color: white;"> ' + command + '</span>' + 
                            '</div>';


            //projetcs command
            if (command[0] == "p" && (command[2] == "d" || command[2] == "i")){
                terminal.projectName = command.slice(4);
                command = command[0] + " " + command[2];
            }
               
            var returnData = await terminal.commandSeeker(command);

            if (returnData == "clear"){
                htmlToAppend = '<div style="margin-top: 20px;" class="inputActiveDiv">' +
                                '<span style="color: bisque;"><span style="color: aquamarine;">guest</span>@<span style="color: lightsalmon;">portfolio.com</span>:$~</span> ' + 
                                '<input class="active" type="text" style="color: white;" autofocus>' + 
                                ' </div>';
            } else if (returnData == "pong game"){
                htmlToAppend = '<div class="game" style="width: 100%; display: inline-flex;">' +
                               '<div id="ball"></div>' +
                               '<div id="spaceship"></div>' +
                               '</div>';

                $(".terminalBody").html(htmlToAppend);
                terminal.pongGameInitialData();                
            } else if (returnData == "login"){
                terminal.isLogin = 1;
                htmlToAppend += terminal.loginForm();
                $(".terminalBody").html(htmlToAppend);
                $(".active").focus();
                $(".terminalBody").animate({ scrollTop: $(".terminalBody").height()*5}, 100);
            }else if (returnData == "feedback"){
                terminal.isFeedback = 1;
                htmlToAppend += terminal.feedbackForm();
                $(".terminalBody").html(htmlToAppend);
                $(".active").focus();
                $(".terminalBody").animate({ scrollTop: $(".terminalBody").height()*5}, 100);
            } else {
                htmlToAppend += returnData;
                htmlToAppend += '<div style="margin-top: 20px; margin-bottom: 20px;" class="inputActiveDiv">' +
                                '<span style="color: bisque;"><span style="color: aquamarine;">guest</span>@<span style="color: lightsalmon;">portfolio.com</span>:$~</span> ' + 
                                '<input class="active" type="text" style="color: white;" autofocus>' + 
                                ' </div>';
            }

            if (returnData != "pong game" && returnData != "login"){
                $(".terminalBody").html(htmlToAppend);
                //$(".terminalBody").scrollTop($(".terminalBody")[0].scrollHeight);  // Auto-scroll to the bottom
                $(".active").focus();
                $(".terminalBody").animate({ scrollTop: $(".terminalBody").height()*5}, 100);
            }
        },

        commandSeeker: async function(command){
            switch (command){
                case "help":          
                    return terminal.helpCommands();
                case "dir":
                    return terminal.dirCommands();
                case "contacts":
                    return terminal.contacts();
                case "cd about":
                    return terminal.cdAbout();
                    break;
                case "cd skills":
                    return terminal.cdSkills();
                    break;
                case "cd education":
                    return terminal.cdEducation();
                    break;
                case "cd projects":
                    return terminal.cdProjects();
                    break;
                case "games":
                    return terminal.games();
                case "clear":
                    return "clear";
                case "game pong":
                    return "pong game";
                case "p d":
                    return terminal.getProjectDesc();
                case "p i":
                    return terminal.getProjectImages();
                case "visit-list":
                    return terminal.visitsList();
                case "feedback-list":
                    return terminal.feedbackList();
                case "login":
                    return "login";
                case "feedback":
                    return "feedback";
                case "download cv":
                    return terminal.download();
                case "quote":
                    return terminal.quote();
                default:
                    return '<span style="color: white;">"' + command + '" is not recognized as an internal command.</span>';
            }          
        },

        helpCommands: function(){
            var help = {'clear':'Clear the terminal', 'dir':'List portfolio sections. Let\'s see what\'s here... Spoiler: nothing classified!', 
            'games':'Show all the games! (Caution: Highly addictive content ahead)',        
            'contacts':'Slide into my DMs. Or, you know, email.', 'feedback':'Your thoughts, my growth. Let’s hear it!',
            'download cv':'My CV! Download it. Frame it. Admire it.', 'quote':'Because sometimes you just need someone else\'s words.'},
            htmlToAppend = "";
            $.each(help, function(index, value){
                htmlToAppend += '<span style="color: white; margin-left: 20px;"> > ' + index + ' - ' + value + '</span>';
            });
            return htmlToAppend;
        },

        dirCommands: function(){
            var dir = {'about':'All about me. Fun facts, life story, and a bit of ego.', 'skills': 'A showcase of my abilities. From code wizardry to database sorcery.', 
                      'education': 'My academic adventures. Degrees, courses, and certifications.', 'projects': 'My portfolio of triumphs (and a few lessons in "what not to do").'},
            htmlToAppend = "";
            $.each(dir, function(index, value){
                htmlToAppend += '<span style="color: white; margin-left: 20px;"> > ' + index + ' - ' + value + '</span>';
            });

            htmlToAppend += '<span style="color: white; margin-top: 30px;">Type \'cd [section]\' to change to the specified section. Ex: cd about.</span>';
            
            return htmlToAppend;
        },

        cdAbout: function(){

            var htmlToAppend = '<div style="margin-top: 30px;">' +
                                '<img src="images/me.jpg" width="15%" class="imgMeAbout" style="opacity: 60%;">' +
                                '<img src="images/namePinkAndLime.png" width="50%" style="margin-left: 20px">' +
                                '</div>';

            htmlToAppend += '<div style="margin-right: 30px; display: inline-grid; margin-top: 15px;">' +
                            '<span class="colorAbout" >Hello! My name is Gonçalo Silva, born on May 22, 2003, based in Portugal, Oliveira de Azeméis <img src="images/portugal.png" width="20px">. I consider myself a humble person with a lot of ambition, dedication, and discipline. I\'m a gym lover who enjoys working out, and programming is my second passion.</span>' +
                            '<br>' +
                            '<span class="colorAbout" >I fell in love with programming during high school when I enrolled in the Professional Course in Computer Technician - Systems. This journey led me to an internship at Metaveiro, a company that opened its doors for me and provided the guidance I needed to embark on this wonderful path in my programming career.</span>' +
                            '<br>' +
                            '<span class="colorAbout" >Currently, I\'m pursuing a Higher Professional Technical Course in Software Development at the University of Aveiro.</span>' +
                            '<br>' +
                            '<span class="colorAbout" >When I\'m not lifting weights at the gym, I\'m probably lifting lines of code. Who says you can\'t have brains and brawn?</span>' +
                            '</div>';
            
            return htmlToAppend;

                
        },

        cdSkills: function(){

            var htmlToAppend = '<div>',
                skills = [['Markup and Styling Languages', {'HTML': ['[##################--]', '90%'], 'CSS': ['[##########----------]', '50%']}],
                         ['Programming Languages', {'Python': ['[############--------]', '60%'], 'Kotlin': ['[############--------]', '60%'], 'C#': ['[##########----------]', '50%'], 'JQuery': ['[##################--]', '90%'], 'PHP': ['[############--------]', '60%']}],
                         ['Frameworks', {'ASP.NET': ['[##########----------]', '50%'], 'Flask': ['[############--------]', '60%'], 'KTor': ['[##############------]', '70%']}],
                         ['Data Base', {'SQL': ['[##############------]', '70%'], 'MySQL': ['[##############------]', '70%']}],
                         ['Mobile Development', {'Android Studio': ['[##############------]', '70%']}]];

            

            $.each(skills, function( index, value ) {
                
                htmlToAppend += '<div class="dashed-border-leftAndRight" style="margin-top: 20px; margin-left:40px;">' +
                                '<div class="dashed-border-topAndBottom" style="padding: 10px;">' +
                                '<span style="color: limegreen;">[' + value[0] + ']</span>' +
                                '</div>' +
                                '<div class="dashed-border-bottom" style="padding: 10px;">' +
                                '<table>';

                $.each(value[1], function(skillName, skillDescription){
                    
                    htmlToAppend += '<tr>'+
                                    '<th style="color: deeppink;">' + skillName + ':</th>'+
                                    '<td>' + skillDescription[0] + '</td>'+
                                    '<td>' + skillDescription[1] + '</td>' +                                                        
                                    '</tr>';
                });

                htmlToAppend += '</table>'+                
                                '</div>'+
                                '</div>';


            });

            htmlToAppend += '</div>';
            
            return htmlToAppend;
                
        },

        cdEducation: function(){

            var htmlToAppend = '',
                education = {'Soares Basto': ['My academic journey began at Soares Basto School,' +
                'where I enrolled in the professional course for Computer Technician - Systems. Initially,' +
                'I was drawn to the hardware side of things, but it didn\'t take long for me to fall head over heels for programming.' +
                'The logic, the creativity, and the constant problem-solving challenges had me hooked.', ['Programming', 'Information Systems and Database', 
                'Network and Computer Architecture', 'Computer Applications']], 
                'ESAN - UA': ['After finishing high school and completing a professional internship, I decided to take my education to the next level.' + 
                'That\’s when I joined the Higher Professional Technical Course in Software Development at the University of Aveiro.' +
                'This course has been an incredible adventure, equipping me with the skills and knowledge I need for a promising career in software development.' , [
                'Higher education in software development, with an emphasis on programming languages, web development, databases, and software engineering.',
                'Practical experience in individual and group projects, including internships in industry-related companies.',
                ' Skills acquired in programming (Kotlin, PHP, Python), web development (HTML, CSS, JavaScript, JQuery), databases (MySQL), and agile development methodologies.']]};


            htmlToAppend += '<div style="margin-right: 30px; display: inline-grid; margin-top: 15px;">' +
                            '<div style="margin-top: 15px; margin-bottom: 30px;">' +
                            '<img src="images/education.png" width="50%">' +
                            '</div>'; 

            $.each(education, function(indexDic, valDic){
                
                htmlToAppend += '<span>' + valDic[0] + '</span>';

                htmlToAppend += '<div class="dashed-border-leftAndRight" style="margin-top: 20px; margin-left:40px;">' +
                                '<div class="dashed-border-topAndBottom" style="padding: 10px;">' +
                                '<span style="color: limegreen;">[Technical Training]</span>' +
                                '</div>' +
                                '<div class="dashed-border-bottom" style="padding: 10px;">' +
                                '<table class="educationTable">';

                $.each(valDic[1], function(indexArray, valArray){
                    
                    htmlToAppend += '<tr>' +
                                    '<th>+</th>' +
                                    '<td>' + valArray + '</td>' +                                                   
                                    '</tr>';
                });

                htmlToAppend += '</table>' +
                                '</div>' +
                                '</div>' +
                                '<br>';

            });

            htmlToAppend += '<span>Now, when I\'m not coding my heart out, you can find me reminiscing about those early days when I thought hardware was my true love.' +
                            'Little did I know, software would sweep me off my feet!</span>';  

            htmlToAppend += '</div>';          

            return htmlToAppend;
                
        },

        cdProjects: function(){

            return new Promise(function(resolve, reject) {
                var htmlToAppend = '';

                htmlToAppend += '<div style="margin-right: 30px; display: inline-grid; margin-top: 15px; color: white">'; 

                $.ajax({
                    url: "https://api.github.com/users/" + terminal.gitHubAccount + "/repos",
                    type: "GET",
                    contentType: "application/json",
                    data: null,
                    success: function (data) {

                        $.each(data, function( key, value ) {
                            htmlToAppend += '|-- ' + value.name + '<br>';
                        });

                        htmlToAppend += '</div>';

                        htmlToAppend += '<span style="color: white; margin-top: 30px;">Type ' + "'p d {project_name}'" + ' to see the project description or ' + "'p i {project_name}'" + ' to see some images of the project.</span>'
                        resolve(htmlToAppend);
                    },
                    error: function (data) {
                        htmlToAppend += 'Error viewing the projects';
                        htmlToAppend += '</div>';
                        resolve(htmlToAppend);
                    }
                });
            });

        },

        getProjectDesc: function(){
          
            return new Promise(function(resolve, reject) {
                var htmlToAppend = '';

                htmlToAppend += '<div style="margin-right: 30px; display: inline-grid; margin-top: 15px; color: white">'; 

                $.ajax({
                    url: "https://api.github.com/repos/" + terminal.gitHubAccount + "/" + terminal.projectName,
                    type: "GET",
                    contentType: "application/json",
                    data: null,
                    success: function (data) {
                        
                        htmlToAppend += '<span style="font-weight: 500;"> > ' + data.name + '</span><br>';
                        htmlToAppend += data.description == null ? 'Project without description' : data.description;
                        htmlToAppend += '</div>';
                        resolve(htmlToAppend); 
                    },
                    error: function (data) {
                        htmlToAppend += 'Project not found';
                        htmlToAppend += '</div>';
                        resolve(htmlToAppend); 
                    }
                });
            });
        },

        getProjectImages: function(){

            return new Promise(function(resolve, reject) {
                var htmlToAppend = '';

                htmlToAppend += '<div style="margin-right: 30px; display: inline-grid; color: white">'; 

                    $.ajax({
                        url: "https://api.github.com/repos/" + terminal.gitHubAccount + "/" + terminal.projectName + "/readme",
                        headers: {
                            "Accept": "application/vnd.github.v3.raw"
                        },
                        success: function(data) {

                            const imageRegex = /!\[(.*?)\]\((.*?)\)/g;
                            var match;

                            while ((match = imageRegex.exec(data)) !== null) {
                                const text = match[1];   
                                const imageUrl = match[2];                 
                                htmlToAppend += '<span class="imgProjectHeader"> > ' + text + '</span>';
                                htmlToAppend += '<img src="https://raw.githubusercontent.com/' + terminal.gitHubAccount + '/' + terminal.projectName + '/main/' + imageUrl + '" class="imgProject" alt="Imagem do projeto">';                                                                  
                            }
                            htmlToAppend += '</div>'; 
                            resolve(htmlToAppend);
                        },
                        error: function(data) {
                            htmlToAppend += 'Project Images not found';
                            htmlToAppend += '</div>';
                            resolve(htmlToAppend);
                        }
                    });
            });
        },

        games: function(){
            var games = {'pong':'The original tennis match, but with rectangles. Get ready to pong like it\s 1972!'},
            htmlToAppend = "";
            $.each(games, function(index, value){
                htmlToAppend += '<span style="color: white; margin-left: 20px;"> > ' + index + ' - ' + value + '</span>';
            });

            htmlToAppend += '<span style="color: white; margin-top: 30px;">Type \'game [game_name]\' to choose a game. Ready to play? Choose your game and let\'s get started!</span>';
           
            return htmlToAppend;
        },

        pongWaitTime: function(){
            var htmlToAppend = '<div id="countdown"></div>',
                numberForCountdown = 3;

            $(".game").html($(".game").html() + htmlToAppend);

            var countdownInterval = setInterval(function(){
                $("#countdown").html(numberForCountdown);
                numberForCountdown--;
                if(numberForCountdown == 0){
                    clearInterval(countdownInterval);
                    setTimeout(function(){
                        $("#countdown").remove();
                        terminal.interval = setInterval((terminal.ballMovement), 10);
                    }, 1000);                 
                }
            }, 1000);    
        },

        pongGameInitialData: function(){
            terminal.gameMode = true;
            terminal.pongWaitTime();   
            terminal.ballDirectionX = terminal.ballInitialShotRandomize(); 

            var htmlToAppend = $(".game").html();
            htmlToAppend += '<div style="color:white; position:absolute; padding: 10px;">Score: <span id="scorePong">0</span></div>';
            $(".game").html(htmlToAppend);
        },

        ballMovement: function(){
            
            var ballX = $("#ball").position().left;
            var ballY = $("#ball").position().top;

            var ballHeight = $("#ball").height();
            var ballWidth = $("#ball").width();

            var spaceshipX = $("#spaceship").position().left;
            var spaceshipY = $("#spaceship").position().top;

            var spaceshipWidth = $("#spaceship").width();
            var spaceshipHeight = $("#spaceship").height();

            //var maxHeight = $(".terminal").height();
            //var maxHeight = $(window).height();
            var maxHeight = $(".terminalBody").position().top;
            var minHeight = $(".terminal").position().top + $(".terminal").height();
            var minWidth = $(".terminal").position().left;
            //var maxWidth = $(".terminal").width() + (($(window).width() - $(".terminal").width()) / 2);
            var maxWidth = ($(".terminal").position().left + $(".terminal").width()) - 22;
            
            var ballTouchesTemp = 0;

            if(((ballY + ballHeight) >= spaceshipY && (spaceshipY + spaceshipHeight) >= (ballY + ballHeight)) && (ballX >=spaceshipX && ballX <= (spaceshipX + $("#spaceship").width()))){
        
                var racketHalf = (spaceshipX + (spaceshipWidth / 2));
                var ballTouchPoint = (ballX + (ballWidth / 2));

                if((spaceshipX + (spaceshipWidth / 2)) >= (ballX + (ballWidth / 2))){
                    terminal.ballDirectionX = -1;
                }else{
                    terminal.ballDirectionX = 1;
                }

                //terminal.ballDirectionX = -1;
                terminal.ballDirectionY = -1;
                terminal.ballTouches += 1;
                ballTouchesTemp = terminal.ballTouches;
                //ballTouchesTemp = terminal.ballTouches;

                $('#scorePong').html(terminal.ballTouches);
            }
            
            if (ballY <= maxHeight){
                terminal.ballDirectionY = 1;
            }

            if (ballX <= minWidth){
                terminal.ballDirectionX = 1;
            }

            if (ballX >= maxWidth){
                terminal.ballDirectionX = -1;
            }

            if (ballY >= minHeight){

                clearInterval((terminal.interval));
                $("#ball").css('top', '20%');
                $("#ball").css('left', '50%');
               
                terminal.pongWaitTime();
                terminal.ballDirectionX = terminal.ballInitialShotRandomize();
                terminal.ballTouches = 0;
                terminal.ballSpeed = 2;
                $('#scorePong').html(terminal.ballTouches);
                
            }else{
                $('#ball').css('left', ballX + (terminal.ballSpeed * terminal.ballDirectionX));
                $('#ball').css('top', ballY + (terminal.ballSpeed * terminal.ballDirectionY));
            }

            if (((ballTouchesTemp % 5) == 0) && (ballTouchesTemp != 0)){
                
                terminal.ballSpeed += 0.2;
            }
            
        },

        ballInitialShotRandomize: function(){
            //1 - left | 2 - right
            var shotSide = 1 + Math.floor(Math.random() * 2);
            var shotAngle = shotSide == 1 ? Math.random() * -1 : Math.random() * 1;

            return shotAngle;
        },
    
    };
    $(document).ready(function () {

        setTimeout(function () {
            $("#loading-screen").fadeOut(500);
        }, 2000); // Tempo de exibição da tela de loading
        
        $("#cmdAlert").hide();

        onAuthStateChanged(auth, (user) => {
            if (user) {
                console.log("Utilizador autenticado:", user.uid);
            } else {
                terminal.getUserIP();
            }
        });
       
        $(".closeTerminal").on("click", function (e) {
            window.close();
        });

        $("#closeAlert").on("click", function (e) {
            terminal.closeAlert();
        });

        $(document).on('keydown', '.active', function(e) {
            if (e.which == 13) {      
                terminal.enter($(".active").val());
            }
        });

        $(document).keydown(function(e) {
            if (terminal.gameMode == true){
                if (e.which == 27) {              
                    var htmlToAppend = '<div style="margin-top: 20px;" class="inputActiveDiv">' +
                                       '<span style="color: bisque;"><span style="color: aquamarine;">guest</span>@<span style="color: lightsalmon;">portfolio.com</span>:$~</span> ' + 
                                       '<input class="active" type="text" style="color: white;" autofocus>' + 
                                       '</div>';

                    
                    clearInterval((terminal.interval));
                    terminal.gameMode = false;
                    //terminal.gameModeInitial = true;
                    $(".terminalBody").html(htmlToAppend);
                    $(".active").focus();
                    $(".terminalBody").animate({ scrollTop: $(".terminalBody").height()*5}, 100);
                }

                var minWidth = $(".terminal").position().left;
                var maxWidth = ($(".terminal").position().left + $(".terminal").width()) - 22;

                const valueToMove = 10,
                      spaceShipPosition = $("#spaceship").position().left;


                if (!((spaceShipPosition - valueToMove) <= minWidth)){            
                    if (e.which == 37) { // 37 is the keycode for the left arrow key                
                        var newPosition = spaceShipPosition - valueToMove;
                        $('#spaceship').css('left', newPosition);
                    }
                }

                if (!(((spaceShipPosition + $("#spaceship").width() - 22) + valueToMove) >= maxWidth)){
                    if (e.which == 39) {                
                        var newPosition = spaceShipPosition + valueToMove;
                        $('#spaceship').css('left', newPosition);
                    }
                }
            }
        });
        
    });
</script>